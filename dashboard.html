<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Martin's KI-Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 0;
    }
    header {
      background: #0a3d62;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }
    .container {
      padding: 1rem;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .button {
      padding: 0.6rem 1rem;
      background: #0a3d62;
      color: #fff;
      border: none;
      border-radius: 5px;
      margin: 0.3rem 0.2rem;
    }
    .status {
      font-weight: bold;
      margin: 0.5rem 0;
    }
    .trade {
      background: #ecf0f1;
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-left: 5px solid #27ae60;
    }
    .danger {
      border-left-color: #c0392b;
    }
    .filter {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }
    input, select {
      padding: 0.5rem;
      width: 100%;
      max-width: 200px;
      margin-top: 0.2rem;
    }
    #pdf-link {
      display: inline-block;
      margin-top: 1rem;
      color: #0a3d62;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>
    <h1>📈 Martin’s KI-Dashboard</h1>
    <p class="status">KI-Modus: <span id="kiStatus">Hybridmodus</span>
      <button class="button" onclick="toggleKI()">Umschalten</button>
    </p>
  </header>

  <div class="container">
    <!-- Kontostand -->
    <div class="card">
      <h3>💼 Kontostand (AvaTrade)</h3>
      <p id="balance">Lade...</p>
      <button class="button" onclick="adjustRisk()">⚙️ Risiko einstellen</button>
    </div>

    <!-- Plattform-/Traderfilter -->
    <div class="card">
      <h3>🔍 Filter</h3>
      <div class="filter">
        <select id="platformFilter" onchange="filterTrades()">
          <option value="">Alle Plattformen</option>
          <option value="AvaTrade">AvaTrade</option>
          <option value="NAGA">NAGA</option>
        </select>
        <input id="traderFilter" placeholder="Tradername..." oninput="filterTrades()" />
      </div>
    </div>

    <!-- Tradeübersicht -->
    <div class="card">
      <h3>📂 Offene Positionen</h3>
      <div id="trades">Lade Trades...</div>
    </div>

    <!-- PDF Report -->
    <div class="card">
      <h3>📄 Tagesreport</h3>
      <p><button class="button" onclick="generatePDF()">PDF generieren</button></p>
      <a id="pdf-link" href="#" target="_blank" style="display:none;">📥 PDF herunterladen</a>
    </div>
  </div>

  <script>
    // Dummy: AvaTrade MetaAPI + NAGA Scraping
    let trades = [
      { id: 1, platform: "AvaTrade", trader: "AI-Bot", symbol: "EUR/USD", direction: "Buy", lot: 0.1, sl: 1.0912, tp: 1.1050, status: "offen" },
      { id: 2, platform: "NAGA", trader: "MaxPower", symbol: "BTC/USD", direction: "Sell", lot: 0.05, sl: 29500, tp: 27500, status: "offen" }
    ];

    function toggleKI() {
      const el = document.getElementById("kiStatus");
      el.textContent = el.textContent === "Hybridmodus" ? "Vollautomatik" : "Hybridmodus";
    }

    function filterTrades() {
      const platform = document.getElementById("platformFilter").value;
      const trader = document.getElementById("traderFilter").value.toLowerCase();
      const list = trades.filter(t => 
        (!platform || t.platform === platform) && 
        (!trader || t.trader.toLowerCase().includes(trader))
      );
      renderTrades(list);
    }

    function renderTrades(list) {
      const container = document.getElementById("trades");
      container.innerHTML = "";
      if (list.length === 0) return container.innerHTML = "<p>Keine Trades gefunden.</p>";
      list.forEach(t => {
        const div = document.createElement("div");
        div.className = "trade" + (t.platform === "NAGA" ? " danger" : "");
        div.innerHTML = `
          <strong>${t.symbol}</strong> (${t.platform})<br/>
          Trader: ${t.trader} – ${t.direction}<br/>
          Lot: ${t.lot}, SL: ${t.sl}, TP: ${t.tp}
        `;
        container.appendChild(div);
      });
    }

    function adjustRisk() {
      alert("Risiko-Einstellung kommt bald.");
    }

    function generatePDF() {
      const link = document.getElementById("pdf-link");
      link.href = "/reports/tagesreport_2025-07-26.pdf";  // Dynamisch setzen per Server
      link.style.display = "inline-block";
    }

    // Start mit vollständiger Liste
    renderTrades(trades);

    // Dummy-Balance
    document.getElementById("balance").textContent = "4.882,50 € (live über MetaAPI)";
  </script>
</body>
</html>