<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AvaTrade KI-Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f2f2;
      color: #222;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #003366;
      color: white;
      padding: 12px;
      text-align: center;
      font-size: 1.4em;
    }
    .container {
      padding: 20px;
    }
    .status {
      margin: 20px 0;
    }
    .status span {
      display: inline-block;
      padding: 8px 14px;
      border-radius: 5px;
      color: white;
      font-weight: bold;
    }
    .green { background: #4caf50; }
    .yellow { background: #fbc02d; }
    .red { background: #f44336; }

    .trade {
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 8px;
      border-left: 5px solid #2196f3;
    }
    .btn {
      padding: 10px 15px;
      background: #003366;
      color: white;
      border: none;
      border-radius: 4px;
      margin-top: 10px;
    }
    .btn:hover {
      background: #005599;
    }
    label {
      font-weight: bold;
    }
    select, input {
      padding: 6px;
      width: 100%;
      margin-bottom: 10px;
    }
    .filter-box {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <header>
    AvaTrade KI-Dashboard
  </header>

  <div class="container">
    <div id="accountBalance">Kontostand: wird geladen...</div>
    <div id="marginStatus" class="status">Margin-Level: wird geladen...</div>

    <div>
      <label for="riskLevel">Risikoeinstellung:</label>
      <select id="riskLevel">
        <option value="0.5">0.5% Risiko</option>
        <option value="1">1% Risiko</option>
        <option value="2">2% Risiko</option>
      </select>
      <button class="btn" onclick="applyRisk()">Risiko Ã¼bernehmen</button>
    </div>

    <div class="filter-box">
      <label for="filterTrader">Filter: Trader oder KI</label>
      <input type="text" id="filterTrader" oninput="filterTrades()" placeholder="z.â€¯B. 'KI' oder Tradername">
    </div>

    <div>
      <label>KI-Modus:</label>
      <select id="aiMode" onchange="setAiMode(this.value)">
        <option value="hybrid">Hybridmodus</option>
        <option value="fullauto">Vollautomatik</option>
      </select>
    </div>

    <div>
      <button class="btn" onclick="downloadPDF()">ðŸ“„ Tagesreport herunterladen</button>
    </div>

    <h3>Offene Positionen:</h3>
    <div id="trades"></div>
  </div>

  <script>
    const token = 'DEIN_METAAPI_TOKEN_HIER';
    let aiMode = 'hybrid';
    let trades = [];

    async function fetchAccountInfo() {
      const balance = 11235.43; // Placeholder, bitte live per MetaAPI ersetzen
      const marginLevel = 84;   // Placeholder
      document.getElementById('accountBalance').innerText = `Kontostand: ${balance.toFixed(2)} â‚¬`;
      updateMarginStatus(marginLevel);
    }

    function updateMarginStatus(level) {
      const el = document.getElementById('marginStatus');
      let color = 'green';
      if (level < 150 && level > 50) color = 'yellow';
      if (level <= 50) color = 'red';
      el.innerHTML = `Margin-Level: <span class="${color}">${level}%</span>`;
    }

    function displayTrades() {
      const container = document.getElementById('trades');
      container.innerHTML = '';
      const filter = document.getElementById('filterTrader').value.toLowerCase();
      trades.filter(t => t.trader.toLowerCase().includes(filter)).forEach(t => {
        const div = document.createElement('div');
        div.className = 'trade';
        div.innerHTML = `
          <strong>${t.symbol}</strong><br>
          Typ: ${t.type} | Lot: ${t.lot} | SL: ${t.sl} | TP: ${t.tp}<br>
          Trader: ${t.trader}<br>
          <button class="btn" onclick="closeTrade('${t.id}')">SchlieÃŸen</button>
        `;
        container.appendChild(div);
      });
    }

    function closeTrade(id) {
      alert(`Trade ${id} wird geschlossen...`);
      // Implementiere hier die MetaAPI Trade Close Logik
    }

    function filterTrades() {
      displayTrades();
    }

    function applyRisk() {
      const level = document.getElementById('riskLevel').value;
      alert(`Risiko-Level gesetzt auf ${level}%`);
      // Implementiere: KI-Logik aktualisieren
    }

    function setAiMode(mode) {
      aiMode = mode;
      alert(`KI-Modus geÃ¤ndert zu: ${mode === 'hybrid' ? 'Hybrid' : 'Vollautomatik'}`);
    }

    function downloadPDF() {
      alert('PDF-Report wird generiert...');
      // Optional: PDFKit oder jspdf einbauen
    }

    function fetchLiveTrades() {
      // Hier erfolgt die echte MetaAPI-Abfrage
      trades = [
        { id: '1234', symbol: 'EURUSD', type: 'Buy', lot: 0.1, sl: 1.095, tp: 1.115, trader: 'KI' },
        { id: '5678', symbol: 'GBPUSD', type: 'Sell', lot: 0.2, sl: 1.285, tp: 1.245, trader: 'JohnDoe' },
      ];
      displayTrades();
    }

    // Initialisierung
    fetchAccountInfo();
    fetchLiveTrades();
  </script>
</body>
</html>